# show a waring on startup if lf is running as a nested instance
%[ $LF_LEVEL -eq 1 ] || echo "WARNING: You're in a nested lf instance!"

# options for shell commands
set shell sh
set shellopts '-eu'
set ifs "\n"

# basic settings
set scrolloff 10
set drawbox

# custom functions
cmd open ${{
    test -L $f && f=$(readlink -f $f)
    case $(file --mime-type $f -b) in
        text/*|application/json) $EDITOR $fx;;
        application/pdf) zathura $fx;;
        *) for f in $fx; do setsid $OPENER $f > /dev/null 2> /dev/null & done;;
    esac
}}

# chmod
cmd chmod %{{
  for f in $fx; do
    chmod $1 $f
  done
  lf -remote "send $id reload"
}}

# move to trash
%mkdir -p ~/.trash
cmd trash %set -f; mv $fx ~/.trash

cmd unarchive ${{
    set -f
    case "$f" in
        *.tar.bz|*.tar.bz2|*.tbz|*.tbz2) tar xjvf "$f";;
        *.tar.gz|*.tgz) tar xzvf "$f";;
        *.tar.xz|*.txz) tar xJvf "$f";;
        *.zip) unzip "$f";;
        *.rar) unrar x "$f";;
        *.7z) 7z x "$f";;
    esac
}}

cmd zip %zip -r "$f" "$f"
cmd tar %tar cvf "$f.tar" "$f"
cmd targz %tar cvzf "$f.tar.gz" "$f"
cmd tarbz %tar cjvf "$f.tar.bz2" "$f"

# unmap default mappings
map c

# archive mappings
map az zip 
map at tar
map ag targz
map ab tarbz
map au unarchive

# basic mappings
map A push %mkdir<space>-p<space>
# map a push %touch <space>
map ch push :chmod<space>

map D trash
map <c-l> reload
map <c-z> $ kill -STOP $PPID
map U clear
map x $$f
map X !$f

map gc cd ~/.config
map gr cd /
map gt cd ~/tmp
map gT cd ~/.trash
map gv cd ~/.config/nvim
