# show a waring on startup if lf is running as a nested instance
%[ $LF_LEVEL -eq 1 ] || echo "WARNING: You're in a nested lf instance!"

# options for shell commands
set shell sh
set shellopts '-eu'
set ifs "\n"

# basic settings
set scrolloff 10
set drawbox

# custom functions
cmd open ${{
    test -L $f && f=$(readlink -f $f)
    case $(file --mime-type $f -b) in
        text/*|application/json) $EDITOR $fx;;
        application/pdf) zathura $fx;;
        *) for f in $fx; do setsid $OPENER $f > /dev/null 2> /dev/null & done;;
    esac
}}

# chmod
cmd chmod %{{
    for f in $fx; do
        chmod $1 $f
    done
    lf -remote "send $id reload"
}}

# y (select for copy) and P to paste soft-link
# d (select for cut) and P to paste hard-link
cmd link %{{
    set -- $(cat ~/.local/share/lf/files)
    mode="$1"
    shift
    if [ "$#" -lt 1 ]; then
        lf -remote "send $id echo no files to link"
        exit 0
    fi
    case "$mode" in
        # symbolically copy mode is indicating a soft link
        copy) ln -sr -t . -- "$@";;
        # while a move mode is indicating a hard link
        move) ln -t . -- "$@";;
    esac
    rm ~/.local/share/lf/files
    lf -remote "send clear"
}}

cmd compile %{{
    ext="${fx##*.}"
    case "$ext" in
        cpp) g++ $fx;;
        c) gcc $fx;;
        *) echo "Wrong file format";;
    esac
    lf -remote "send unselect"
}}

# move to trash
%mkdir -p ~/.trash
cmd trash %set -f; mv $fx ~/.trash

cmd unarchive ${{
    set -f
    case "$f" in
        *.tar.bz|*.tar.bz2|*.tbz|*.tbz2) tar xjvf "$f";;
        *.tar.gz|*.tgz) tar xzvf "$f";;
        *.tar.xz|*.txz) tar xJvf "$f";;
        *.zip) unzip "$f";;
        *.rar) unrar x "$f";;
        *.7z) 7z x "$f";;
    esac
}}

cmd zip %zip -r "$f" "$f"
cmd tar %tar cvf "$f.tar" "$f"
cmd targz %tar cvzf "$f.tar.gz" "$f"
cmd tarbz %tar cjvf "$f.tar.bz2" "$f"

# unmap default mappings
map c

# archive mappings
map az zip 
map at tar
map ag targz
map ab tarbz
map au unarchive

# basic mappings
map A push %mkdir<space>-p<space>
# map a push %touch <space>
map ch push :chmod<space>
map cc compile

map D trash
map P :link
map <c-l> reload
map <c-z> $ kill -STOP $PPID
map U clear
map x $$f
map X !$f

map gc cd ~/.config
map gr cd /
map gt cd ~/tmp
map gT cd ~/.trash
map gv cd ~/.config/nvim
